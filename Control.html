<!DOCTYPE html>
<html>
<head>
    <title>Painel de Controle Centralizado IR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial; text-align: center; background-color: #f4f4f9; }
        .ac-unit { border: 1px solid #ccc; padding: 20px; margin: 20px auto; border-radius: 8px; background-color: #fff; display: inline-block; width: 320px; box-shadow: 2px 2px 10px rgba(0,0,0,0.1); }
        .ip-input, select { width: 100%; padding: 8px; margin-bottom: 10px; box-sizing: border-box; border-radius: 4px; border: 1px solid #ddd; }
        .btn { padding: 10px 15px; margin: 5px; cursor: pointer; border: none; border-radius: 5px; color: white; width: 45%; }
        .btn-on { background-color: #4CAF50; }
        .btn-off { background-color: #f44336; }
        .btn-apply { background-color: #007bff; width: 95%; margin-top: 10px; }
        .status { margin-top: 10px; font-size: 0.9em; color: #555; height: 1.2em; }
        label { display: block; text-align: left; margin-top: 5px; font-weight: bold; }
    </style>
</head>
<body>

    <h1>Controle Central de Ar Condicionado (v1.0)</h1>
    <p>Painel de Controle Unificado para ESP32s.</p>

    <div class="ac-unit" id="ac-sala">
        <h2>AC Sala (ID: sala)</h2>
        <label for="ip-sala">Endereço IP:</label>
        <input type="text" class="ip-input" id="ip-sala" value="192.168.1.101">
        
        <button class="btn btn-on" onclick="sendIrCommand('sala', 'L')">LIGAR</button>
        <button class="btn btn-off" onclick="sendIrCommand('sala', 'D')">DESLIGAR</button>
        
        <hr style="border-top: 1px solid #eee;">
        
        <label for="temp-sala">Temperatura (T):</label>
        <select id="temp-sala">
            <script>for(let i=16; i<=30; i++) { document.write(`<option value="T ${i}">${i}°C</option>`); }</script>
        </select>

        <label for="modo-sala">Modo (MOD):</label>
        <select id="modo-sala">
            <option value="MOD1">Modo 1 (Frio)</option>
            <option value="MOD2">Modo 2 (Seco)</option>
            <option value="MOD3">Modo 3 (Ventilar)</option>
            <option value="MOD4">Modo 4</option>
            <option value="MOD5">Modo 5</option>
        </select>
        
        <button class="btn btn-apply" onclick="sendCommandFromSelectors('sala')">APLICAR AJUSTES</button>
        <button class="btn btn-apply" style="background-color: #3f51b5; margin-top: 5px;" onclick="sendIrCommand('sala', 'SW')">SWING (Oscilar)</button>

        <div class="status" id="status-sala">Aguardando comandos...</div>
    </div>
    
    
    <script>
        // FUNÇÃO AUXILIAR: Envia qualquer comando simples (L, D, SW)
        async function sendIrCommand(unitId, command) {
            const ipElement = document.getElementById(`ip-${unitId}`);
            const statusElement = document.getElementById(`status-${unitId}`);
            const ipAddress = ipElement.value;
            const encodedCommand = encodeURIComponent(command);
            const url = `http://${ipAddress}/enviar?cmd=${encodedCommand}`;

            // Reset status visual
            statusElement.textContent = `Enviando ${command}...`;
            statusElement.style.color = '#555';
            
            try {
                const response = await fetch(url);
                const text = await response.text();
                
                if (response.ok) {
                    statusElement.textContent = `OK: ${command} enviado.`;
                    statusElement.style.color = 'green';
                } else {
                    statusElement.textContent = `ERRO (${response.status}): ${text.substring(0, 50)}...`;
                    statusElement.style.color = 'red';
                }
            } catch (error) {
                /*
                statusElement.textContent = `ERRO DE REDE: O ESP32 em ${ipAddress} não respondeu.`;
                statusElement.style.color = 'darkred';
                */
            }
            
        }
        
        // FUNÇÃO PRINCIPAL: Monta e envia os comandos selecionados (T e MOD)
        function sendCommandFromSelectors(unitId) {
            const tempSelect = document.getElementById(`temp-${unitId}`);
            const modoSelect = document.getElementById(`modo-${unitId}`);
            
            // Comandos a serem enviados: 'T 28' e 'MOD3'
            const tempCommand = tempSelect.value;
            const modoCommand = modoSelect.value;

            // Envia o comando de Temperatura
            sendIrCommand(unitId, tempCommand); 
            // Pequeno delay é opcional, mas pode ajudar o AC a processar
            setTimeout(() => {
                // Envia o comando de Modo
                sendIrCommand(unitId, modoCommand); 
            }, 500); 
        }
    </script>
</body>
</html>